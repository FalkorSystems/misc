# Install Ubuntu on Beagle
# http://elinux.org/BeagleBoardUbuntu#Precise_12.04_armhf

wget http://rcn-ee.net/deb/rootfs/quantal/ubuntu-12.10-r1-minimal-armhf-2012-10-19.tar.xz

tar xJfv ubuntu-12.10-r1-minimal-armhf-2012-10-19.tar.xz
cd ubuntu-12.10-r1-minimal-armhf-2012-10-19

sudo apt-get install wget pv dosfstools parted git-core

sudo ./setup_sdcard.sh --probe-mmc

sudo ./setup_sdcard.sh --mmc /dev/sdX --uboot bone

# Connect to beaglebone, connect to network

ssh -l ubuntu 192.168.10.13
wget http://packages.ros.org/ros.key -O - | sudo apt-key add -

sudo apt-get update
sudo apt-get upgrade

# http://www.ros.org/wiki/fuerte/Installation/Ubuntu/Source

sudo apt-get install python-pip build-essential python-yaml cmake subversion wget python-setuptools mercurial git-core python-yaml libapr1-dev libaprutil1-dev libbz2-dev python-dev python-empy python-nose libgtest-dev python-paramiko libboost-all-dev liblog4cxx10-dev pkg-config python-serial python-sip python-sip-dev libeigen3-dev libcppunit-dev git-flow vim libtinyxml-dev unzip libblas-dev liblapack-dev python-numpy libxml2-dev xterm emacs dbus libcanberra-gtk-module graphviz evince gcc-multilib gdb python-smbus ntp python-matplotlib hostapd dhcp3-server bind9


sudo pip install -U rosinstall vcstools rospkg rosdep pyserial xbee progressbar

wget http://ros.org/rosinstalls/fuerte-ros-base.rosinstall
# edit and replace wg-debs with ros-gbp for action lib

rosinstall --catkin ~/ros-underlay fuerte-ros-base.rosinstall

cd ~/ros-underlay

mkdir build
cd build

cmake .. -DCMAKE_INSTALL_PREFIX=/opt/ros/fuerte
make ; make ; make ; make
sudo make install

sudo rosdep init
rosdep update

sudo rm -rf ros-underlay fuerte-ros-base.rosinstall

## ROS workspace
mkdir ~/ros
cd ~/ros
rosws init
source setup.sh

git config --global user.name "Your Name"
git config --global user.email "you@example.com"
git config --global credential.helper 'cache --timeout=3600'

git clone https://github.com/FalkorSystems/misc

# run mkswap so we have enough swap to compile everything
misc/mkswap

cp misc/rosinstall-beagle .rosinstall

source setup.sh

rosws update --parallel=4
source setup.sh

sudo sh -c "echo 'source /opt/ros/fuerte/setup.bash' >> /etc/bash.bashrc"
echo 'source ~/ros/setup.sh' >> ~/.bashrc

sudo usermod -a -G dialout ubuntu
sudo usermod -a -G kmem ubuntu
sudo usermod -a -G i2c ubuntu

# Configure WiFi Access Point and DHCP
cat > /etc/hostapd/hostapd.conf <<EOF
interface=wlan1
driver=nl80211
ssid=FalkorRobot
hw_mode=g
channel=11
wpa=0
EOF

cat > /etc/network/interfaces <<EOF
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

auto wlan1
iface wlan1 inet static
	address 10.10.0.1
	netmask 255.255.255.0
EOF

cat > /etc/default/isc-dhcp-server <<EOF
INTERFACES="wlan1"
EOF

cat > /etc/dhcp/dhcpd.conf <<EOF
ddns-update-style none;
default-lease-time 600;
max-lease-time 7200;

subnet 10.10.0.0 netmask 255.255.255.0 {
	range 10.10.0.10 10.10.0.20
}
EOF

cat >/dev/default/hostapd <<EOF
DAEMON_CONF="/etc/hostapd/hostapd.conf"
RUN_DAEMON="YES"
EOF

echo robot > /etc/hostname
cat >> /etc/hosts.conf <<EOF
10.10.0.1	robot
10.10.0.10	controller
EOF

# save the image
# put the SD back in your pc
# (XG is 16G or whatnot)
sudo dd if=/dev/sdX bs=4096 | pv -s XG | dd bs=4096 of=~/BEAGLE_ROS_BACKUP.IMG

# restore from an image
dd if=~/BEAGLE_ROS_BACKUP.IMG bs=4096 | pv -s XG | sudo dd bs=4096 of=/dev/sdX



